<h1><%= @report.date.strftime("%Y年%m月%d日") %> <%= t("activerecord.models.report") %></h1>

<table class="table table-striped table-bordered table-hover table-narrow">
  <tr>
    <th><%=t "activerecord.attributes.report.car_id" %></th>
    <th><%=t "activerecord.attributes.report.driver_id" %></th>
    <th><%=t "activerecord.attributes.report.mileage" %></th>
    <th><%=t "activerecord.attributes.report.riding_mileage" %></th>
    <th><%=t "activerecord.attributes.report.riding_rate" %></th>
    <th><%=t "activerecord.attributes.report.riding_count" %></th>
    <th><%=t "activerecord.attributes.report.meter_fare_count" %></th>
    <th><%=t "activerecord.attributes.report.passengers" %></th>
    <th><%=t "activerecord.attributes.report.sales" %></th>
    <th><%=t "activerecord.attributes.report.sales_per_kilometer" %></th>
    <th><%=t "activerecord.attributes.report.fuel_cost" %></th>
    <th><%=t "activerecord.attributes.report.ticket" %></th>
    <th><%=t "activerecord.attributes.report.account_receivable" %></th>
    <th><%=t "activerecord.attributes.report.cash" %></th>
    <th><%=t "activerecord.attributes.report.surplus_funds" %></th>
    <th><%=t "activerecord.attributes.report.deficiency_account" %></th>
    <th><%=t "activerecord.attributes.report.advance" %></th>
    <th><%=t "activerecord.attributes.report.started_at" %></th>
    <th><%=t "activerecord.attributes.report.finished_at" %></th>
    <th><%=t "activerecord.attributes.report.working_hours" %></th>
    <th><%=t "activerecord.attributes.report.rest_hours" %></th>
    <th><%=t "activerecord.attributes.report.real_working_hours" %></th>
  </tr>

  <tr>
    <td><%= @report.car.name %></td>
    <td><%= @report.driver.name %></td>
    <td><%= number_with_delimiter @report.mileage %><% if @report.mileage %>Km<% end %></td>
    <td><%= number_with_delimiter @report.riding_mileage %><% if @report.riding_mileage %>Km<% end %></td>
    <td><%= number_to_percentage(@report.riding_mileage/@report.mileage, :precision => 0) rescue "" %></td>
    <td><%= number_with_delimiter @report.riding_count %><% if @report.riding_count %>回<% end %></td>
    <td><%= number_with_delimiter @report.meter_fare_count %><% if @report.meter_fare_count %>回<% end %></td>
    <td><%= number_with_delimiter @report.passengers %><% if @report.passengers %>人<% end %></td>
    <td><%= number_to_currency @report.sales, :locale => "ja" %></td>
    <td><%= number_to_currency(@report.sales/@report.mileage, :precision => 0, :locale => "ja") rescue "" %></td>
    <td><%= number_to_currency @report.fuel_cost, :locale => "ja" %></td>
    <td><%= number_to_currency @report.ticket, :locale => "ja" %></td>
    <td><%= number_to_currency @report.account_receivable, :locale => "ja" %></td>
    <td><%= number_to_currency @report.cash, :locale => "ja" %></td>
    <td><%= number_to_currency @report.surplus_funds, :locale => "ja" %></td>
    <td><%= number_to_currency @report.deficiency_account, :locale => "ja" %></td>
    <td><%= number_to_currency @report.advance, :locale => "ja" %></td>
    <td><%= @report.started_at.strftime("%H時%M分") %></td>
    <td><%= @report.finished_at.strftime("%H時%M分") rescue nil %></td>
    <td>
      <% if @report.finished_at %>
        <%= (@report.finished_at - @report.started_at).divmod(60*60)[0] %>時間<%= (@report.finished_at - @report.started_at).divmod(60*60)[1].divmod(60)[0] %>分
      <% end %>
    </td>
    <td><%= @estimated_rest[0] %>時間<%= @estimated_rest[1] %>分</td>
    <td>
      <% if @report.finished_at %>
        <%= ((@report.finished_at - @report.started_at).to_i - (@estimated_rest[0]*60*60 + @estimated_rest[1]*60)).divmod(60*60)[0] %>時間<%= ((@report.finished_at - @report.started_at).to_i - (@estimated_rest[0]*60*60 + @estimated_rest[1]*60)).divmod(60*60)[1].divmod(60)[0] %>分
      <% end %>
    </td>
  </tr>
</table>

<% if @report.rests %>
  <h2><%=t "activerecord.models.rest" %></h2>
  <p><%= link_to t("link.new") + t("activerecord.models.rest"), "#{new_rest_path}?report_id=#{@report.id}" %></p>
  <table class="table table-striped table-bordered table-hover table-narrow">
    <tr>
      <th><%=t "activerecord.attributes.rest.location" %></th>
      <th><%=t "activerecord.attributes.rest.started_at" %></th>
      <th><%=t "activerecord.attributes.rest.ended_at" %></th>
      <th></th>
      <th></th>
    </tr>
    <% @report.rests.each do |rest| %>
      <tr>
        <td><%= rest.location %></td>
        <td><%= rest.started_at.strftime("%Y年%m月%d日 %H時%M分") %></td>
        <td><%= rest.ended_at.strftime("%Y年%m月%d日 %H時%M分") %></td>
        <td><%= link_to t("link.edit"), edit_rest_path(rest) %></td>
        <td><%= link_to t("link.destroy"), rest, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </table>

  <table class="table table-striped table-bordered table-hover table-narrow">
    <tr>
      <th><%=t "activerecord.attributes.rest.estimated_rest" %></th>
      <td><%= @estimated_rest[0] %>時間<%= @estimated_rest[1] %>分</td>
    </tr>
  </table>
<% end %>

<% if @report.rides %>
  <h2><%=t "activerecord.models.ride" %></h2>
  <p><%= link_to t("link.new") + t("activerecord.models.ride"), "#{new_ride_path}?report_id=#{@report.id}" %></p>
  <table class="table table-striped table-bordered table-hover table-narrow">
    <tr>
      <th><%=t "activerecord.attributes.ride.ride_address" %></th>
      <th><%=t "activerecord.attributes.ride.leave_address" %></th>
      <th><%=t "activerecord.attributes.ride.passengers" %></th>
      <th><%=t "activerecord.attributes.ride.fare" %></th>
      <th></th>
      <th></th>
    </tr>
    <% @report.rides.each do |ride| %>
      <tr>
        <td><%= ride.ride_address %></td>
        <td><%= ride.leave_address %></td>
        <td><%= ride.passengers %></td>
        <td><%= ride.fare %></td>
        <td><%= link_to t("link.edit"), edit_ride_path(ride) %></td>
        <td><%= link_to t("link.destroy"), ride, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </table>
<% end %>

<%= link_to t("link.new") + t("activerecord.models.report"), new_report_path, :class => "btn" %>
<%= link_to t("link.edit"), edit_report_path(@report), :class => "btn" %>
<%= link_to t("link.back"), reports_path, :class => "btn" %>
