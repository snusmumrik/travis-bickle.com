<%= gmaps(:map_options => {:language => "ja", :center_latitude => controller.current_user.latitude, :center_longitude => controller.current_user.longitude, :maxZoom => 17, :zoom => 14, :auto_adjust => false},
          :markers => {:data => @json}) %>

<% content_for :scripts do %>
  <script type="text/javascript" charset="utf-8">
    Gmaps.map.callback = function() {
      for (var i = 0; i < Gmaps.map.markers.length; ++i) {
        google.maps.event.addListener(Gmaps.map.markers[i].serviceObject, 'click', function(object) {
        });
      }
    }
  </script>
<% end %>

<table class="table table-striped table-bordered table-hover">
  <tr>
    <th><%=t "activerecord.attributes.location.car" %></th>
    <th><%=t "activerecord.attributes.location.address" %></th>
    <th><%=t "activerecord.attributes.location.updated_at" %></th>
    <th></th>
  </tr>

<% @locations.each do |location| %>
  <tr>
    <td><%= link_to location.car.name, report_path(location.car.reports.where("finished_at IS NULL").last) rescue nil %></td>
    <td><%= location.address %></td>
    <td><%= location.updated_at.strftime("%Y/%m/%d %H:%M:%S") rescue nil %></td>
    <td><%= link_to t("activerecord.models.report"), report_path(location.car.reports.where("finished_at IS NULL").last) rescue nil %></td>
  </tr>
<% end %>
</table>

